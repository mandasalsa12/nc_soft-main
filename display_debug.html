<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Koordinat Shape - Nurse Call Response System</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">Debug Koordinat Shape</h1>
        
        <div class="grid grid-cols-2 gap-6">
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="font-semibold mb-3">Data dari Config</h2>
                <pre id="config-data" class="text-sm bg-gray-100 p-3 rounded overflow-auto"></pre>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="font-semibold mb-3">Canvas Info</h2>
                <pre id="canvas-info" class="text-sm bg-gray-100 p-3 rounded overflow-auto"></pre>
            </div>
        </div>
        
        <div class="mt-6 bg-white p-4 rounded-lg shadow">
            <h2 class="font-semibold mb-3">Shape Positions</h2>
            <div id="shape-positions" class="text-sm"></div>
        </div>
        
        <div class="mt-6">
            <button id="load-data" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                Load Data
            </button>
            <button id="save-test" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                Save Test Position
            </button>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        async function loadDisplayConfig() {
            try {
                const config = await ipcRenderer.invoke('get-display-config');
                document.getElementById('config-data').textContent = JSON.stringify(config, null, 2);
                
                if (config && config.shapes) {
                    let html = '';
                    config.shapes.forEach((shape, index) => {
                        html += `<div class="mb-2 p-2 border rounded">
                            <strong>${shape.code}</strong> (${shape.type})<br>
                            Position: (${shape.x}, ${shape.y})<br>
                            Size: ${shape.width} x ${shape.height}<br>
                            Color: ${shape.color}
                        </div>`;
                    });
                    document.getElementById('shape-positions').innerHTML = html;
                }
                
                // Test canvas info
                setTimeout(() => {
                    const img = document.querySelector('#floorplan-img');
                    const canvas = document.querySelector('#shape-canvas');
                    const container = document.querySelector('#floorplan-container');
                    
                    if (img && canvas && container) {
                        const imgRect = img.getBoundingClientRect();
                        const containerRect = container.getBoundingClientRect();
                        
                        const canvasInfo = {
                            imgRect: {
                                width: imgRect.width,
                                height: imgRect.height,
                                left: imgRect.left,
                                top: imgRect.top
                            },
                            containerRect: {
                                width: containerRect.width,
                                height: containerRect.height,
                                left: containerRect.left,
                                top: containerRect.top
                            },
                            offsets: {
                                x: imgRect.left - containerRect.left,
                                y: imgRect.top - containerRect.top
                            },
                            canvas: {
                                width: canvas.width,
                                height: canvas.height,
                                styleWidth: canvas.style.width,
                                styleHeight: canvas.style.height,
                                styleTop: canvas.style.top,
                                styleLeft: canvas.style.left
                            }
                        };
                        
                        document.getElementById('canvas-info').textContent = JSON.stringify(canvasInfo, null, 2);
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Error loading config:', error);
                document.getElementById('config-data').textContent = 'Error: ' + error.message;
            }
        }

        async function saveTestPosition() {
            try {
                const testShape = {
                    code: '1999',
                    type: 'TEST',
                    x: 200,
                    y: 150,
                    width: 90,
                    height: 70,
                    color: '#ff0000',
                    blinking: false
                };
                
                const config = await ipcRenderer.invoke('get-display-config');
                if (config) {
                    config.shapes = config.shapes || [];
                    // Remove existing test shape
                    config.shapes = config.shapes.filter(s => s.code !== '1999');
                    // Add new test shape
                    config.shapes.push(testShape);
                    
                    await ipcRenderer.invoke('update-display-config', config);
                    alert('Test shape saved at position (200, 150)');
                    loadDisplayConfig();
                }
            } catch (error) {
                console.error('Error saving test position:', error);
                alert('Error: ' + error.message);
            }
        }

        document.getElementById('load-data').addEventListener('click', loadDisplayConfig);
        document.getElementById('save-test').addEventListener('click', saveTestPosition);

        // Auto load on startup
        document.addEventListener('DOMContentLoaded', loadDisplayConfig);
    </script>
</body>
</html> 